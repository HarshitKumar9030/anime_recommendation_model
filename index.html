<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Recommendation</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
        }

        .card {
            background-color: #1e1e1e;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .input-field,
        .select-field,
        .textarea-field {
            background-color: #2c2c2c;
            border: none;
            color: #e0e0e0;
            transition: background-color 0.2s ease;
        }

        .input-field:focus,
        .select-field:focus,
        .textarea-field:focus {
            background-color: #373737;
        }

        .button {
            background-color: #3b82f6; 
            color: #fff;
        }

        .button:hover {
            background-color: #2563eb;
        }

        .floating-elements {
            animation: float 6s ease-in-out infinite;
            fill: #3b82f6;
        }

        @keyframes float {
            0% {
                transform: translatey(0px);
            }
            50% {
                transform: translatey(-8px);
            }
            100% {
                transform: translatey(0px);
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100">

    <div class="min-h-screen flex items-center justify-center px-4">
        <div class="w-full max-w-md card rounded-xl p-8 space-y-6 relative">
            <h1 class="text-3xl font-semibold text-center text-white">Anime Recommendations</h1>

            <div class="space-y-4">
                <label for="userType" class="block text-sm font-medium text-gray-400">User Type</label>
                <select id="userType" class="select-field mt-1 block w-full rounded-md p-2 focus:ring focus:ring-indigo-500">
                    <option value="existing">Existing User</option>
                    <option value="new">New User</option>
                </select>
            </div>

            <div id="existingUserForm" class="space-y-4">
                <label for="watchHistory" class="block text-sm font-medium text-gray-400">Watch History (Anime:Rating)</label>
                <textarea id="watchHistory" rows="4" class="outline-none textarea-field mt-1 block w-full rounded-md p-2 focus:ring focus:ring-indigo-500"
                    placeholder="e.g., Naruto:5,Attack on Titan:4"></textarea>
            </div>

            <div id="newUserForm" class="space-y-4 hidden">
                <label for="preferredGenres" class="block text-sm font-medium text-gray-400">Preferred Genres</label>
                <input id="preferredGenres" type="text"
                    class="input-field mt-1 block w-full rounded-md p-2 focus:ring focus:ring-indigo-500"
                    placeholder="e.g., Action, Adventure">

                <label for="likedAnimeTitles" class="block text-sm font-medium text-gray-400">Liked Anime Titles</label>
                <input id="likedAnimeTitles" type="text"
                    class="input-field mt-1 block w-full rounded-md p-2 focus:ring focus:ring-indigo-500"
                    placeholder="e.g., Naruto, One Piece">
            </div>

            <button id="submitBtn" class="button w-full rounded-md py-2 mt-4">Get Recommendations</button>

            <div id="recommendations" class="mt-6 text-center text-gray-300"></div>
        </div>
    </div>

    <script>
        document.getElementById('userType').addEventListener('change', function () {
            const userType = this.value;
            document.getElementById('existingUserForm').classList.toggle('hidden', userType !== 'existing');
            document.getElementById('newUserForm').classList.toggle('hidden', userType !== 'new');
        });

        document.getElementById('submitBtn').addEventListener('click', function () {
            const userType = document.getElementById('userType').value;
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = '';

            if (userType === 'existing') {
                const watchHistory = document.getElementById('watchHistory').value.split(',').reduce((acc, curr) => {
                    const [anime, rating] = curr.split(':');
                    if (anime && rating) acc[anime.trim()] = parseInt(rating.trim());
                    return acc;
                }, {});

                axios.post('http://127.0.0.1:5000/recommend/existing', {
                    watch_history: watchHistory
                })
                    .then(response => {
                        recommendationsDiv.innerHTML = `<h2 class="text-lg font-semibold text-white">Recommendations:</h2><p>${response.data.recommendations.join(', ')}</p>`;
                    })
                    .catch(error => {
                        recommendationsDiv.innerHTML = `<p class="text-red-500">Error: ${error.response.data.error}</p>`;
                    });

            } else {
                const preferredGenres = document.getElementById('preferredGenres').value.split(',').map(g => g.trim());
                const likedAnimeTitles = document.getElementById('likedAnimeTitles').value.split(',').map(a => a.trim());

                axios.post('http://127.0.0.1:5000/recommend/new', {
                    preferred_genres: preferredGenres,
                    liked_anime_titles: likedAnimeTitles
                })
                    .then(response => {
                        console.log(response.data)
                        recommendationsDiv.innerHTML = `<h2 class="text-lg font-semibold text-white">Recommendations:</h2><p>${response.data.recommendations.join(', ')}</p>`;
                    })
                    .catch(error => {
                        recommendationsDiv.innerHTML = `<p class="text-red-500">Error: ${error.response.data.error}</p>`;
                    });
            }
        });
    </script>

</body>

</html>
